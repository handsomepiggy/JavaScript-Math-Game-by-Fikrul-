<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quick Math! â€“ JS Quiz Game</title>
  <meta name="description" content="A lightweight JavaScript math quiz game with score, progress, difficulty settings, SFX, and optional BGM." />
  <style>
    :root{
      --bg: #0f1226; /* deep indigo */
      --surface:#171a35;
      --text:#ecf0ff;
      --muted:#aab0d6;
      --accent:#6d8cff; /* periwinkle */
      --accent-2:#5de2a0; /* mint */
      --danger:#ff5d7a;
      --card-w: min(720px, 92vw);
      --radius: 18px;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 80% -10%, #26327a55, transparent 60%),
        radial-gradient(900px 500px at -10% 110%, #1e9f7a33, transparent 60%),
        var(--bg);
      display:grid; place-items:center;
      padding:28px 16px;
    }

    .card{ width:var(--card-w); background:linear-gradient(180deg, #1a1e44 0%, #121533 100%); border:1px solid #2b3172; border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; }
    header{ padding:18px 22px; display:flex; gap:14px; align-items:center; justify-content:space-between; border-bottom:1px solid #2b3172; background:linear-gradient(180deg, #1f2452 0%, #1a1e44 100%); }
    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{ width:36px; height:36px; border-radius:10px; background: conic-gradient(from 220deg, var(--accent), var(--accent-2)); box-shadow:0 0 0 3px #ffffff10 inset; }
    .title{ font-size: clamp(18px, 2.4vw, 22px); font-weight:800; letter-spacing:.3px; }

    .controls{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
    .select, .btn{ appearance:none; border:1px solid #3640a3; background:#12153a; color:var(--text); padding:10px 12px; border-radius:12px; font-weight:600; letter-spacing:.2px; }
    .select{ min-width:140px; }
    .btn{ background:linear-gradient(180deg, var(--accent) 0%, #4f6eff 100%); border-color:#6d8cff; cursor:pointer; }
    .btn[disabled]{ opacity:.6; cursor:not-allowed; }
    .ghost{ background:#12153a; border-color:#2b3172; }

    .toggle{ display:flex; align-items:center; gap:8px; padding:8px 10px; background:#0f1338; border:1px solid #2b3172; border-radius:12px; font-size:13px; color:var(--muted); }
    .toggle input[type="checkbox"]{ width:36px; height:20px; accent-color: var(--accent); }

    main{ padding:26px 22px 24px; }

    .stats{ display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:10px; margin-bottom:16px; }
    .stat{ background:#101338; border:1px solid #2b3172; border-radius:12px; padding:10px 12px; }
    .stat .label{ color:var(--muted); font-size:12px; letter-spacing:.2px; }
    .stat .value{ font-weight:800; font-size:18px; margin-top:4px; }

    .progress-wrap{ margin:12px 0 18px; }
    .progress{ height:10px; background:#0e1130; border:1px solid #2b3172; border-radius:999px; overflow:hidden; }
    .bar{ height:100%; width:0%; background:linear-gradient(90deg, var(--accent) 0%, var(--accent-2) 100%); transition:width .25s ease; }

    .question{ display:grid; gap:14px; place-items:center; text-align:center; padding:16px 10px 8px; }
    .q-text{ font-size: clamp(28px, 7vw, 56px); font-weight:900; letter-spacing:1px; text-shadow:0 2px 0 #0006; }

    .answer-row{ display:flex; gap:10px; justify-content:center; align-items:center; margin:8px 0 4px; flex-wrap:wrap; }
    .input{ width:200px; max-width:70vw; padding:12px 14px; font-size:20px; text-align:center; font-weight:800; letter-spacing:.5px; color:var(--text); background:#0d1030; border:2px solid #2b3172; border-radius:12px; outline:none; }
    .input:focus{ border-color:#6d8cff; box-shadow:0 0 0 3px #6d8cff33; }

    .feedback{ min-height:28px; text-align:center; font-weight:800; margin-top:4px; }
    .ok{ color: var(--accent-2); }
    .bad{ color: var(--danger); }

    .footer-cta{ display:flex; gap:10px; justify-content:center; margin-top:12px; }

    .divider{ height:1px; background:#2b3172; margin:18px 0; }

    .summary{ display:none; padding:8px 4px 0; text-align:center; }
    .summary h2{ margin:0 0 4px; font-size: clamp(20px, 3.2vw, 28px); }
    .summary p{ color:var(--muted); margin:4px 0 10px; }
    .grid-sm{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; }
    .pill{ background:#0e1130; border:1px solid #2b3172; border-radius:12px; padding:10px 12px; }

    footer{ padding:16px 22px 22px; color:var(--muted); font-size:13px; display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px; }
    footer a{ color:var(--text); text-decoration:underline; text-underline-offset:3px; }

    @media (max-width:560px){ .stats{ grid-template-columns: repeat(2, minmax(0,1fr)); } .grid-sm{ grid-template-columns: repeat(2, minmax(0,1fr)); } }

    /* --- Animations --- */
    @keyframes pulseCorrect { 0%{ transform:scale(1); box-shadow:0 0 0 0 rgba(93,226,160,0.6)} 70%{ transform:scale(1.02); box-shadow:0 0 0 12px rgba(93,226,160,0)} 100%{ transform:scale(1); box-shadow:0 0 0 0 rgba(93,226,160,0)} }
    @keyframes shakeWrong { 10%, 90% { transform: translateX(-1px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }
    .pulse { animation: pulseCorrect .45s ease; }
    .shake { animation: shakeWrong .45s ease; }
    .glow-ok { border-color: var(--accent-2) !important; box-shadow: 0 0 0 3px #5de2a033 !important; }
    .glow-bad{ border-color: var(--danger) !important; box-shadow: 0 0 0 3px #ff5d7a33 !important; }
  </style>
</head>
<body>
  <div class="card" id="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">Quick Math!</div>
      </div>
      <div class="controls">
        <select id="op" class="select" aria-label="Operation">
          <option value="mixed">Mixed</option>
          <option value="add">Addition (+)</option>
          <option value="sub">Subtraction (âˆ’)</option>
          <option value="mul">Multiplication (Ã—)</option>
          <option value="div">Division (Ã·)</option>
        </select>
        <select id="level" class="select" aria-label="Difficulty">
          <option value="easy">Easy</option>
          <option value="med" selected>Medium</option>
          <option value="hard">Hard</option>
        </select>
        <select id="total" class="select" aria-label="Total Questions">
          <option>5</option>
          <option selected>10</option>
          <option>15</option>
          <option>20</option>
        </select>
        <label class="toggle" title="Sound effects">
          <input type="checkbox" id="sfx" checked>
          <span>SFX</span>
        </label>
        <label class="toggle" title="Background music">
          <input type="checkbox" id="bgmToggle">
          <span>BGM</span>
        </label>
        <button id="start" class="btn">Start</button>
        <button id="reset" class="btn ghost" disabled>Reset</button>
      </div>
    </header>

    <main>
      <section class="stats" aria-live="polite">
        <div class="stat"><div class="label">Question</div><div class="value" id="statQ">â€“/â€“</div></div>
        <div class="stat"><div class="label">Score</div><div class="value" id="statScore">0</div></div>
        <div class="stat"><div class="label">Streak</div><div class="value" id="statStreak">0</div></div>
        <div class="stat"><div class="label">Best (this setup)</div><div class="value" id="statBest">0</div></div>
      </section>

      <div class="progress-wrap" aria-hidden="true">
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>

      <section class="question" id="questionWrap">
        <div id="qText" class="q-text">Press <em>Start</em> to begin</div>
        <div class="answer-row">
          <input id="answer" class="input" type="text" inputmode="numeric" pattern="[0-9-]*" autocomplete="off" placeholder="Your answer" disabled aria-label="Your answer" />
          <button id="submit" class="btn" disabled>Submit</button>
          <button id="next" class="btn ghost" style="display:none">Next</button>
        </div>
        <div id="feedback" class="feedback" aria-live="polite"></div>
      </section>

      <div class="divider"></div>

      <section class="summary" id="summary">
        <h2 id="sumTitle">Great job!</h2>
        <p id="sumInfo">Here are your results.</p>
        <div class="grid-sm">
          <div class="pill"><div class="label">Correct</div><div class="value" id="sumCorrect">0</div></div>
          <div class="pill"><div class="label">Accuracy</div><div class="value" id="sumAcc">0%</div></div>
          <div class="pill"><div class="label">Time</div><div class="value" id="sumTime">0s</div></div>
        </div>
        <div class="footer-cta">
          <button id="again" class="btn">Play Again</button>
          <button id="share" class="btn ghost">Copy Share Text</button>
        </div>
      </section>
    </main>

    <footer>
      <span>Built with vanilla JS â€¢ No libraries</span>
      <span></span>
    </footer>
  </div>

  <!-- Background music element. Place a file named bgm.mp3 in the repo root, or change the src path below. -->
  <audio id="bgm" loop preload="auto" src="bgm.mp3"></audio>

  <script>
    // Utility helpers
    const $ = (q) => document.querySelector(q);
    const fmt = (n) => new Intl.NumberFormat().format(n);

    const state = {
      config: { op: 'mixed', level: 'med', total: 10 },
      index: 0,
      score: 0,
      streak: 0,
      current: null,
      startTime: 0,
      elapsed: 0,
      ended: false,
      mistakes: [],
      audioCtx: null,
      started: false,
    };

    // Difficulty ranges
    const ranges = {
      easy: { add:[0,10], sub:[0,10], mul:[0,5], div:[1,5] },
      med:  { add:[0,50], sub:[0,50], mul:[0,12], div:[1,12] },
      hard: { add:[0,100], sub:[0,100], mul:[0,15], div:[2,15] }
    };

    function randInt(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }
    function pickOp(op){ if(op !== 'mixed') return op; const bag = ['add','add','sub','mul','div']; return bag[Math.floor(Math.random()*bag.length)]; }

    function makeQuestion(){
      const op = pickOp(state.config.op);
      const r = ranges[state.config.level];
      let a,b,ans,txt;
      if(op==='add'){ a = randInt(...r.add); b = randInt(...r.add); ans = a + b; txt = `${a} + ${b}`; }
      else if(op==='sub'){ a = randInt(...r.sub); b = randInt(...r.sub); if(b>a) [a,b]=[b,a]; ans = a - b; txt = `${a} âˆ’ ${b}`; }
      else if(op==='mul'){ a = randInt(...r.mul); b = randInt(...r.mul); ans = a * b; txt = `${a} Ã— ${b}`; }
      else { // div integer
        b = randInt(...r.div); const k = randInt(1, (state.config.level==='hard'? 20 : 12)); a = b * k; ans = Math.trunc(a / b); txt = `${a} Ã· ${b}`;
      }
      return { a,b,op,ans,txt };
    }

    function updateStats(){
      $('#statQ').textContent = `${state.index}/${state.config.total}`;
      $('#statScore').textContent = fmt(state.score);
      $('#statStreak').textContent = fmt(state.streak);
      const key = bestKey();
      const best = Number(localStorage.getItem(key)||0);
      $('#statBest').textContent = fmt(best);
      const pct = (state.index/state.config.total)*100; $('#bar').style.width = pct + '%';
    }

    function bestKey(){ const {op, level, total} = state.config; return `best:${op}:${level}:${total}`; }

    function setFeedback(ok, msg){
      const el = $('#feedback');
      if (msg !== undefined) { el.textContent = msg; }
      else { el.textContent = ok ? 'Correct!' : 'Wrong'; }
      el.className = 'feedback ' + (ok? 'ok' : 'bad');
    }

    function showQuestion(){
      state.current = makeQuestion();
      $('#qText').textContent = state.current.txt + ' = ?';
      const input = $('#answer');
      input.value = '';
      input.disabled = false;
      input.focus();
      input.classList.remove('glow-ok','glow-bad','shake','pulse');
      $('#questionWrap').classList.remove('shake','pulse');
      setFeedback(true, '');
      $('#next').style.display = 'none';
      $('#submit').disabled = false;
      updateStats();
    }

    function lockControls(lock){
      $('#op').disabled = lock; $('#level').disabled = lock; $('#total').disabled = lock; $('#start').disabled = lock; $('#reset').disabled = !lock; $('#submit').disabled = !lock; $('#answer').disabled = !lock;
    }

    // --- BGM helpers ---
    const bgmEl = $('#bgm');
    function fadeTo(audio, target=0.4, ms=600, done){
      const steps = 20; const stepTime = ms/steps; const diff = target - audio.volume; let n = 0;
      const id = setInterval(()=>{ n++; audio.volume = Math.max(0, Math.min(1, audio.volume + diff/steps)); if(n>=steps){ clearInterval(id); if(done) done(); } }, stepTime);
    }
    function playBGM(){
      if(!$('#bgmToggle').checked) return;
      try{
        bgmEl.volume = 0.0;
        const p = bgmEl.play();
        if(p && typeof p.then==='function'){
          p.then(()=>fadeTo(bgmEl, 0.35, 700)).catch(()=>{});
        }
      }catch(e){ /* autoplay may be blocked until user clicks; Start is a user action so it's fine */ }
    }
    function stopBGM(){
      if(bgmEl.paused) return;
      fadeTo(bgmEl, 0.0, 400, ()=>{ bgmEl.pause(); bgmEl.currentTime = 0; });
    }

    function startGame(){
      state.config = { op: $('#op').value, level: $('#level').value, total: Number($('#total').value) };
      state.index = 0; state.score=0; state.streak=0; state.mistakes=[]; state.ended=false; state.started=true;
      state.startTime = performance.now();
      $('#summary').style.display='none';
      lockControls(true);
      playBGM();
      next();
    }

    function endGame(){
      state.ended = true;
      lockControls(false);
      $('#submit').disabled = true; $('#answer').disabled = true; $('#next').style.display='none';
      state.elapsed = Math.round((performance.now() - state.startTime)/1000);
      const key = bestKey(); const best = Number(localStorage.getItem(key)||0); if(state.score > best){ localStorage.setItem(key, String(state.score)); }
      updateStats();
      const acc = Math.round((state.score / state.config.total)*100);
      $('#sumTitle').textContent = acc===100? 'Flawless! ðŸ†' : acc>=70? 'Nice work! âœ¨' : 'Good effort! ðŸ’ª';
      $('#sumInfo').textContent = `You finished ${state.config.total} question(s) on ${labelOf(state.config.level)} / ${labelOp(state.config.op)}.`;
      $('#sumCorrect').textContent = `${state.score} / ${state.config.total}`;
      $('#sumAcc').textContent = `${acc}%`;
      $('#sumTime').textContent = `${state.elapsed}s`;
      $('#summary').style.display = 'block';
      const oldList = document.getElementById('mistakes'); if(oldList) oldList.remove();
      if(state.mistakes.length){
        const div = document.createElement('div');
        div.id='mistakes'; div.style.marginTop = '10px';
        div.innerHTML = `<div class="label" style="margin-bottom:6px;color:var(--muted)">Review mistakes:</div>` + state.mistakes.map(m=>`<div class="pill" style="margin-top:6px">${m.txt} = <strong>${m.ans}</strong> (you: ${m.your})</div>`).join('');
        document.getElementById('summary').appendChild(div);
      }
      stopBGM();
    }

    function labelOf(level){ return level==='easy'?'Easy': level==='med'? 'Medium': 'Hard'; }
    function labelOp(op){ switch(op){ case 'add': return 'Addition'; case 'sub': return 'Subtraction'; case 'mul': return 'Multiplication'; case 'div': return 'Division'; default: return 'Mixed'; } }

    // --- Sound effects (Web Audio, no external files) ---
    function ensureAudio(){ if(state.audioCtx) return state.audioCtx; const C = new (window.AudioContext||window.webkitAudioContext)(); state.audioCtx = C; return C; }
    function beep({freq=880, type='sine', dur=0.12, gain=0.08}){
      const C = ensureAudio(); const t = C.currentTime; const o = C.createOscillator(); const g = C.createGain();
      o.type = type; o.frequency.value = freq; g.gain.value = gain; o.connect(g).connect(C.destination); o.start(t); o.stop(t+dur);
    }
    function playCorrect(){ if(!$('#sfx').checked) return; beep({freq:620,type:'sine',dur:0.08,gain:0.05}); setTimeout(()=>beep({freq:840,type:'sine',dur:0.10,gain:0.06}),70); }
    function playWrong(){ if(!$('#sfx').checked) return; beep({freq:220,type:'square',dur:0.08,gain:0.06}); setTimeout(()=>beep({freq:180,type:'square',dur:0.10,gain:0.05}),70); }

    function submit(){
      if(state.ended) return;
      const raw = $('#answer').value.trim();
      if(raw==='') { setFeedback(false, 'Enter an answer'); $('#answer').classList.add('glow-bad','shake'); $('#questionWrap').classList.add('shake'); setTimeout(()=>{ $('#answer').classList.remove('shake'); $('#questionWrap').classList.remove('shake'); }, 500); return; }
      const guess = Number(raw);
      if(!Number.isFinite(guess)) { setFeedback(false, 'Please enter a number'); return; }

      const ok = (guess === state.current.ans);
      if(ok){
        state.score++; state.streak++; setFeedback(true, 'Correct!'); playCorrect();
        $('#answer').classList.remove('glow-bad'); $('#answer').classList.add('glow-ok'); $('#questionWrap').classList.add('pulse'); setTimeout(()=>{ $('#questionWrap').classList.remove('pulse'); }, 480);
      } else {
        state.streak=0; setFeedback(false, `Wrong â†’ ${state.current.txt} = ${state.current.ans}`); playWrong();
        $('#answer').classList.remove('glow-ok'); $('#answer').classList.add('glow-bad'); $('#questionWrap').classList.add('shake'); setTimeout(()=>{ $('#questionWrap').classList.remove('shake'); }, 600);
        state.mistakes.push({ ...state.current, your: raw });
      }

      // Lock input and show Next so user controls the pace
      $('#submit').disabled = true; $('#answer').disabled = true; $('#next').style.display = 'inline-block';
      state.index++; updateStats();
      if(state.index >= state.config.total){ // last question: change Next -> Finish
        $('#next').textContent = 'Finish';
      } else {
        $('#next').textContent = 'Next';
      }
    }

    function next(){
      if(state.index >= state.config.total){ endGame(); return; }
      $('#answer').disabled = false; $('#submit').disabled = false; $('#next').style.display = 'none';
      showQuestion();
    }

    // Events
    $('#start').addEventListener('click', startGame);
    $('#reset').addEventListener('click', ()=>{
      state.ended = true; state.started=false; lockControls(false); $('#qText').textContent = 'Press Start to begin'; $('#feedback').textContent=''; $('#bar').style.width='0%'; $('#statQ').textContent='â€“/â€“'; $('#statScore').textContent='0'; $('#statStreak').textContent='0'; $('#summary').style.display='none'; $('#answer').value=''; $('#next').style.display='none'; stopBGM();
    });
    $('#submit').addEventListener('click', submit);
    $('#next').addEventListener('click', next);
    $('#again').addEventListener('click', startGame);
    $('#answer').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ if(!$('#submit').disabled) submit(); else if($('#next').style.display!=='none') next(); }});

    // Toggle BGM while game is running
    $('#bgmToggle').addEventListener('change', ()=>{
      if(!state.started) return; // only react during a game
      if($('#bgmToggle').checked) playBGM(); else stopBGM();
    });

    // Initialize best score display
    updateStats();
  </script>
</body>
</html>
